openapi: 3.0.3
info:
  title: Hi-ring ATS/CRM API
  description: |
    Recruitment platform API providing ATS (Applicant Tracking System) and CRM capabilities.

    ## Authentication
    All endpoints require authentication via NextAuth.js session cookies.

    ## Rate Limiting
    - General endpoints: 10 requests/minute
    - Authentication endpoints: 5 requests/minute

    ## Pagination
    List endpoints support pagination with `page` and `limit` query parameters.
    Default limit: 20, Max limit: 100

    ## Status Codes
    - 200: Success
    - 400: Bad Request (validation error)
    - 401: Unauthorized (no session)
    - 403: Forbidden (insufficient permissions)
    - 404: Not Found
    - 409: Conflict (duplicate resource)
    - 500: Internal Server Error

  version: 1.0.0
  contact:
    name: Hi-ring Support
    email: support@hi-ring.com
  license:
    name: Proprietary

servers:
  - url: http://localhost:3000
    description: Development server
  - url: https://staging.hi-ring.com
    description: Staging server
  - url: https://hi-ring.com
    description: Production server

tags:
  - name: Candidates
    description: Candidate management operations
  - name: Interviews
    description: Interview scheduling and feedback
  - name: Tasks
    description: Task and follow-up management
  - name: Comments
    description: Threaded comments on candidates
  - name: Documents
    description: Document upload and management
  - name: Workflows
    description: Workflow automation
  - name: Users
    description: User management
  - name: Jobs
    description: Job posting management
  - name: Notifications
    description: User notifications

paths:
  /api/candidates:
    get:
      tags:
        - Candidates
      summary: List and search candidates
      description: |
        Retrieve a paginated list of candidates with optional filtering and sorting.
        Supports text search, status filtering, skills filtering, and more.
      operationId: getCandidates
      parameters:
        - name: page
          in: query
          description: Page number (1-indexed)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Results per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: search
          in: query
          description: Text search across name, email, position, company
          schema:
            type: string
        - name: status
          in: query
          description: Filter by status (comma-separated)
          schema:
            type: string
            example: "new,contacted,screening"
        - name: experienceLevel
          in: query
          description: Filter by experience level (comma-separated)
          schema:
            type: string
            example: "junior,mid,senior"
        - name: skills
          in: query
          description: Filter by skills (comma-separated)
          schema:
            type: string
            example: "javascript,react,node.js"
        - name: assignedTo
          in: query
          description: Filter by assigned user ID
          schema:
            type: string
        - name: sortBy
          in: query
          description: Field to sort by
          schema:
            type: string
            enum: [createdAt, updatedAt, lastContactedAt, rating, name]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort direction
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  candidates:
                    type: array
                    items:
                      $ref: '#/components/schemas/CandidateSummary'
                  total:
                    type: integer
                    description: Total number of candidates matching filters
                  page:
                    type: integer
                  limit:
                    type: integer
                  totalPages:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

    post:
      tags:
        - Candidates
      summary: Create a new candidate
      description: Create a new candidate in the system
      operationId: createCandidate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCandidateRequest'
      responses:
        '200':
          description: Candidate created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Candidate created successfully"
                  candidateId:
                    type: string
                    example: "507f1f77bcf86cd799439011"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Conflict - Email already exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Candidate with this email already exists"
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

  /api/candidates/{id}:
    get:
      tags:
        - Candidates
      summary: Get candidate by ID
      description: Retrieve detailed information about a specific candidate
      operationId: getCandidateById
      parameters:
        - name: id
          in: path
          required: true
          description: Candidate ObjectId
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  candidate:
                    $ref: '#/components/schemas/CandidateDetail'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

    put:
      tags:
        - Candidates
      summary: Update candidate
      description: Update an existing candidate's information
      operationId: updateCandidate
      parameters:
        - name: id
          in: path
          required: true
          description: Candidate ObjectId
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCandidateRequest'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

    delete:
      tags:
        - Candidates
      summary: Delete candidate
      description: Soft delete a candidate (sets isDeleted flag)
      operationId: deleteCandidate
      parameters:
        - name: id
          in: path
          required: true
          description: Candidate ObjectId
          schema:
            type: string
        - name: permanent
          in: query
          description: If true, permanently delete the candidate and related data
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

  /api/candidates/bulk:
    post:
      tags:
        - Candidates
      summary: Bulk update candidates
      description: |
        Perform bulk operations on multiple candidates:
        - Update status
        - Assign to user
        - Add tags
        - Delete
      operationId: bulkUpdateCandidates
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - candidateIds
                - action
              properties:
                candidateIds:
                  type: array
                  items:
                    type: string
                  minItems: 1
                  example: ["507f1f77bcf86cd799439011", "507f1f77bcf86cd799439012"]
                action:
                  type: string
                  enum: [updateStatus, assignTo, addTags, delete]
                data:
                  type: object
                  description: Action-specific data
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  updatedCount:
                    type: integer
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'
      security:
        - sessionCookie: []

  /api/candidates/{id}/interviews:
    get:
      tags:
        - Interviews
      summary: Get candidate interviews
      description: Retrieve all interviews for a specific candidate
      operationId: getCandidateInterviews
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  interviews:
                    type: array
                    items:
                      $ref: '#/components/schemas/Interview'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - sessionCookie: []

    post:
      tags:
        - Interviews
      summary: Schedule interview
      description: Schedule a new interview for a candidate
      operationId: scheduleInterview
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateInterviewRequest'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  interviewId:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionCookie: []

  /api/documents:
    post:
      tags:
        - Documents
      summary: Upload document
      description: Upload a document (resume, cover letter, etc.)
      operationId: uploadDocument
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
                - entityType
                - entityId
              properties:
                file:
                  type: string
                  format: binary
                  description: File to upload (max 10MB)
                entityType:
                  type: string
                  enum: [candidate, interview, task]
                entityId:
                  type: string
                  description: ID of the related entity
                type:
                  type: string
                  enum: [resume, cover_letter, portfolio, certificate, other]
                  default: other
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  documentId:
                    type: string
                  url:
                    type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '413':
          description: File too large
      security:
        - sessionCookie: []

  /api/workflows:
    get:
      tags:
        - Workflows
      summary: List workflows
      description: Retrieve all workflow automations
      operationId: getWorkflows
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  workflows:
                    type: array
                    items:
                      $ref: '#/components/schemas/Workflow'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - sessionCookie: []

components:
  securitySchemes:
    sessionCookie:
      type: apiKey
      in: cookie
      name: next-auth.session-token
      description: NextAuth.js session cookie

  schemas:
    CandidateSummary:
      type: object
      properties:
        id:
          type: string
          example: "507f1f77bcf86cd799439011"
        firstName:
          type: string
          example: "John"
        lastName:
          type: string
          example: "Doe"
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        phone:
          type: string
          example: "+33612345678"
        currentPosition:
          type: string
          example: "Senior Developer"
        currentCompany:
          type: string
          example: "Tech Corp"
        experienceLevel:
          $ref: '#/components/schemas/ExperienceLevel'
        status:
          $ref: '#/components/schemas/CandidateStatus'
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        overallRating:
          type: number
          minimum: 1
          maximum: 5
          nullable: true
        assignedTo:
          type: string
          nullable: true
        assignedToName:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CandidateDetail:
      allOf:
        - $ref: '#/components/schemas/CandidateSummary'
        - type: object
          properties:
            workExperience:
              type: array
              items:
                $ref: '#/components/schemas/WorkExperience'
            education:
              type: array
              items:
                $ref: '#/components/schemas/Education'
            interviews:
              type: array
              items:
                $ref: '#/components/schemas/Interview'
            notes:
              type: array
              items:
                $ref: '#/components/schemas/Note'
            activities:
              type: array
              items:
                $ref: '#/components/schemas/Activity'
            tags:
              type: array
              items:
                type: string

    CreateCandidateRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
        - experienceLevel
        - source
      properties:
        firstName:
          type: string
          minLength: 1
          example: "Jane"
        lastName:
          type: string
          minLength: 1
          example: "Smith"
        email:
          type: string
          format: email
          example: "jane.smith@example.com"
        phone:
          type: string
          example: "+33612345678"
        currentPosition:
          type: string
          example: "Frontend Developer"
        experienceLevel:
          $ref: '#/components/schemas/ExperienceLevel'
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        source:
          type: string
          example: "LinkedIn"
        availability:
          $ref: '#/components/schemas/AvailabilityStatus'
        contractPreference:
          type: array
          items:
            $ref: '#/components/schemas/ContractPreference'
        status:
          $ref: '#/components/schemas/CandidateStatus'
        assignedTo:
          type: string
          description: User ID to assign candidate to

    UpdateCandidateRequest:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        currentPosition:
          type: string
        currentCompany:
          type: string
        experienceLevel:
          $ref: '#/components/schemas/ExperienceLevel'
        status:
          $ref: '#/components/schemas/CandidateStatus'
        skills:
          type: array
          items:
            $ref: '#/components/schemas/Skill'
        tags:
          type: array
          items:
            type: string
        assignedTo:
          type: string

    Skill:
      type: object
      required:
        - name
        - level
      properties:
        name:
          type: string
          example: "JavaScript"
        level:
          type: string
          enum: [beginner, intermediate, advanced, expert]
          example: "expert"
        yearsOfExperience:
          type: number
          example: 5
        lastUsed:
          type: string
          example: "2024"
        certified:
          type: boolean

    WorkExperience:
      type: object
      properties:
        id:
          type: string
        company:
          type: string
        position:
          type: string
        location:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
          nullable: true
        isCurrent:
          type: boolean
        description:
          type: string
        technologies:
          type: array
          items:
            type: string

    Education:
      type: object
      properties:
        id:
          type: string
        institution:
          type: string
        degree:
          type: string
        field:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
        grade:
          type: string

    Interview:
      type: object
      properties:
        id:
          type: string
        candidateId:
          type: string
        title:
          type: string
        scheduledDate:
          type: string
          format: date-time
        duration:
          type: integer
          description: Duration in minutes
        type:
          type: string
          enum: [phone, video, in_person, technical, hr]
        interviewers:
          type: array
          items:
            type: string
          description: User IDs of interviewers
        location:
          type: string
        meetingLink:
          type: string
        status:
          type: string
          enum: [scheduled, completed, cancelled, rescheduled]
        feedback:
          type: array
          items:
            $ref: '#/components/schemas/InterviewFeedback'

    CreateInterviewRequest:
      type: object
      required:
        - title
        - scheduledDate
        - type
        - interviewers
      properties:
        title:
          type: string
        scheduledDate:
          type: string
          format: date-time
        duration:
          type: integer
          default: 60
        type:
          type: string
          enum: [phone, video, in_person, technical, hr]
        interviewers:
          type: array
          items:
            type: string
        location:
          type: string
        meetingLink:
          type: string
        notes:
          type: string

    InterviewFeedback:
      type: object
      properties:
        interviewerId:
          type: string
        interviewerName:
          type: string
        submittedAt:
          type: string
          format: date-time
        recommendation:
          type: string
          enum: [strong_hire, hire, maybe, no_hire, strong_no_hire]
        summary:
          type: string
        ratings:
          type: object
          properties:
            technical:
              type: integer
              minimum: 1
              maximum: 5
            communication:
              type: integer
              minimum: 1
              maximum: 5
            problemSolving:
              type: integer
              minimum: 1
              maximum: 5
            cultureFit:
              type: integer
              minimum: 1
              maximum: 5

    Note:
      type: object
      properties:
        id:
          type: string
        authorId:
          type: string
        authorName:
          type: string
        content:
          type: string
        createdAt:
          type: string
          format: date-time
        isPrivate:
          type: boolean

    Activity:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum:
            - status_change
            - note_added
            - interview_scheduled
            - document_uploaded
            - email_sent
            - call_made
            - application_submitted
            - profile_updated
        description:
          type: string
        userId:
          type: string
        userName:
          type: string
        timestamp:
          type: string
          format: date-time
        metadata:
          type: object

    Workflow:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        trigger:
          type: object
          properties:
            event:
              type: string
              enum:
                - candidate_created
                - status_changed
                - interview_scheduled
                - interview_completed
                - document_uploaded
            conditions:
              type: array
              items:
                type: object
        actions:
          type: array
          items:
            type: object
            properties:
              type:
                type: string
                enum: [send_email, create_task, update_status, assign_to, send_notification]
              config:
                type: object
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time

    CandidateStatus:
      type: string
      enum:
        - new
        - contacted
        - screening
        - interview_scheduled
        - interview_completed
        - offer_sent
        - offer_accepted
        - offer_rejected
        - hired
        - rejected
        - on_hold
        - archived

    ExperienceLevel:
      type: string
      enum:
        - entry
        - junior
        - mid
        - senior
        - lead
        - executive

    AvailabilityStatus:
      type: string
      enum:
        - immediate
        - two_weeks
        - one_month
        - two_months
        - three_months
        - negotiable
        - not_available

    ContractPreference:
      type: string
      enum:
        - cdi
        - cdd
        - freelance
        - stage
        - alternance
        - interim
        - any

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
        details:
          description: Additional error details
          oneOf:
            - type: string
            - type: object
            - type: array
              items:
                type: object

  responses:
    Unauthorized:
      description: Unauthorized - No valid session
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Unauthorized"

    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Forbidden: Insufficient permissions"

    BadRequest:
      description: Bad Request - Invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Invalid input"
            details:
              - field: "email"
                message: "Invalid email format"

    NotFound:
      description: Not Found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Candidate not found"

    InternalError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "Internal server error"
